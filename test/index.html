<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Microstrip Line Calculator</title>
    <style>
      :root {
        --accent: #2f6f9f;
        --muted: #6b6b6b;
        --card: #fff;
        --bg: #f6f7f8;
      }
      body {
        font-family: Inter, Segoe UI, Roboto, Arial, sans-serif;
        background: var(--bg);
        color: #222;
        margin: 0;
        padding: 28px;
      }
      .container {
        max-width: 980px;
        margin: 0 auto;
        background: linear-gradient(180deg, #ffffff 0%, #fbfbfb 100%);
        box-shadow: 0 6px 18px rgba(20, 20, 40, 0.06);
        border-radius: 6px;
        padding: 22px;
      }
      h1 {
        font-size: 26px;
        color: var(--accent);
        margin: 6px 0 18px;
      }
      .layout {
        display: grid;
        grid-template-columns: 1fr 420px;
        gap: 20px;
      }
      .preview {
        background: #fff;
        border: 1px solid #e6e6e6;
        padding: 12px;
        border-radius: 6px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .preview img {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
      }
      .panel {
        padding: 6px 10px;
      }
      .section-title {
        font-weight: 700;
        margin: 8px 0;
        color: #333;
      }
      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      label {
        display: block;
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      input[type="text"],
      input[type="number"],
      select {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        font-size: 14px;
      }
      .row {
        display: flex;
        gap: 10px;
        align-items: flex-end;
      }
      .controls {
        display: flex;
        gap: 10px;
        margin-top: 12px;
      }
      button {
        background: var(--accent);
        color: #fff;
        border: 0;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
      }
      button.secondary {
        background: #e6f0f7;
        color: var(--accent);
        border: 1px solid #cfe6f3;
      }
      .fieldset {
        background: #fff;
        border-radius: 6px;
        padding: 14px;
        border: 1px solid #eee;
        margin-top: 14px;
      }
      .two-col {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .desc {
        font-size: 13px;
        color: #444;
        line-height: 1.5;
        margin-top: 12px;
      }
      .footnote {
        font-size: 12px;
        color: #777;
        margin-top: 10px;
      }
      @media (max-width: 900px) {
        .layout {
          grid-template-columns: 1fr;
        }
        .preview {
          order: 2;
        }
      }
    </style>
  </head>
  <body>
    <div class="container" role="main">
      <h1>Microstrip Line Calculator</h1>

      <form class="layout" id="microstripForm" method="POST">
        <div class="panel">
          <div class="preview" aria-hidden="true">
            <!-- place image1.jpg (user-supplied) next to this HTML file in same folder -->
            <img
              src="{{ url_for('static', filename='images/image1.jpg') }}"
              alt="Microstrip diagram (image1.jpg)"
            />
          </div>

          <div class="fieldset">
            <div class="section-title">Substrate Parameters</div>
            <div class="form-grid">
              <div>
                <label for="er">Dielectric Constant (ε<sub>r</sub>)</label>
                <input
                  id="er"
                  name="er"
                  type="number"
                  step="0.01"
                  value="4.4"
                  min="1"
                />
              </div>
              <div>
                <label for="h">Dielectric Height (h)</label>
                <div style="display: flex; gap: 8px">
                  <input
                    id="h"
                    name="h"
                    type="number"
                    step="0.01"
                    value="1.6"
                  />
                  <select id="hUnit" name="hUnit">
                    <option>mm</option>
                    <option>cm</option>
                  </select>
                </div>
              </div>
              <div>
                <label for="freq">Frequency</label>
                <div style="display: flex; gap: 8px">
                  <input
                    id="freq"
                    name="freq"
                    type="number"
                    step="0.01"
                    value="2.4"
                  />
                  <span style="align-self: center; color: var(--muted)"
                    >GHz</span
                  >
                </div>
              </div>
              <div></div>
            </div>
          </div>

          <div class="fieldset">
            <div class="section-title">Formula</div>
            <div>
              <label for="formula">Select Formula</label>
              <select id="formula" name="formula">
                <option>Hammerstad and jensen</option>
                <option>Wheeler 1965</option>
                <option>Wheeler 1977</option>
                <option>Hammerstad 1975</option>
                <option>Schneider</option>
              </select>
            </div>
          </div>

          <div class="fieldset">
            <div class="section-title">Electrical Parameters</div>
            <div class="two-col">
              <div>
                <label for="zo">Z<sub>o</sub></label>
                <input id="zo" name="zo" type="number" step="0.01" value="50" />
              </div>
              <div>
                <label for="elecLen">Elec. Length</label>
                <div style="display: flex; gap: 8px">
                  <input
                    id="elecLen"
                    name="elecLen"
                    type="number"
                    step="0.01"
                    value="45"
                  />
                  <span style="align-self: center; color: var(--muted)"
                    >deg</span
                  >
                </div>
              </div>
            </div>
            <div class="controls">
              <button id="synth" type="button">Synthesize</button>
              <button id="analyze" class="secondary" type="button">
                Analyze
              </button>
            </div>
          </div>
        </div>

        <aside class="panel">
          <div class="fieldset">
            <div class="section-title">Physical Parameters</div>
            <div class="two-col">
              <div>
                <label for="w">Width (W)</label>
                <div style="display: flex; gap: 8px">
                  <input id="w" name="w" type="number" step="0.01" value="3" />
                  <select id="wUnit" name="wUnit">
                    <option>mm</option>
                    <option>cm</option>
                  </select>
                </div>
              </div>
              <div>
                <label for="l">Length (L)</label>
                <div style="display: flex; gap: 8px">
                  <input id="l" name="l" type="number" step="0.01" value="2" />
                  <select id="lUnit" name="lUnit">
                    <option>mm</option>
                    <option>cm</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="desc">
              The microstrip calculator determines the width and length of a
              microstrip line for a given characteristic impedance
              (Z<sub>o</sub>) and electrical length or vice versa. Enter
              substrate parameters (ε<sub>r</sub>, h) and frequency of interest
              to proceed.
            </div>
          </div>

          <div class="fieldset">
            <div class="section-title">Quick Tips</div>
            <ul style="margin: 8px 0 0 18px; color: #444">
              <li>
                Click <em>Synthesize</em> to compute rough W/L from Z<sub
                  >o</sub
                >
                and electrical length (demo).
              </li>
              <li>
                Values shown are approximate — replace with precise microwave
                formulas if needed.
              </li>
            </ul>
            <div class="footnote">
              Created for demo/visual purposes. Ask if you want exact RF design
              formulas integrated.
            </div>
          </div>
        </aside>
      </form>
    </div>
    <script>
      document
        .getElementById("synth")
        .addEventListener("click", async function () {
          // Get substrate parameters
          const er = parseFloat(document.getElementById("er").value);
          let h = parseFloat(document.getElementById("h").value);
          const freq= parseFloat(document.getElementById("freq").value);
          const hUnit = document.getElementById("hUnit").value;

          // Convert h to mm if needed
          if (hUnit === "cm") h *= 10;

          // Get formula
          const formula = document.getElementById("formula").value;

          // Get electrical parameters
          const zo = parseFloat(document.getElementById("zo").value);
          const elecLen = parseFloat(document.getElementById("elecLen").value);

          // Prepare payload
            
            const payload = {
            er: er,
            h: h,
            formula: formula,
            zo: zo,
            elecLen: elecLen,
            freq: freq
          };


          // Call Django backend (assume /synthesize/ endpoint returns {width_mm, length_mm})
          const response = await fetch("/synthesize", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const data = await response.json();

          // Set width and length, converting to selected units if needed
          let width = data.width_mm;
          let length = data.length_mm;

          const wUnit = document.getElementById("wUnit").value;
          const lUnit = document.getElementById("lUnit").value;

          if (wUnit === "cm") width = width / 10;
          if (lUnit === "cm") length = length / 10;

          document.getElementById("w").value = width.toFixed(2);
          document.getElementById("l").value = length.toFixed(2);
        });
    </script>
      
    <script>
      function setupUnitConverter(fieldId, unitId) {
        const field = document.getElementById(fieldId);
        const unit = document.getElementById(unitId);

        unit.addEventListener("change", () => {
          let value = parseFloat(field.value);
          if (isNaN(value)) return;

          // Convert based on new selected unit
          if (unit.value === "cm") {
            field.value = (value / 10).toFixed(2); // mm → cm
          } else {
            field.value = (value * 10).toFixed(2); // cm → mm
          }
        });
      }

      // Attach to Width and Length fields
      setupUnitConverter("w", "wUnit");
      setupUnitConverter("l", "lUnit");
    </script>
    <script>
  document.getElementById("analyze").addEventListener("click", async function () {
    // Get substrate parameters
    const er = parseFloat(document.getElementById("er").value) || 0;
    const freq = parseFloat(document.getElementById("freq").value) || 0;
    let h = parseFloat(document.getElementById("h").value) || 0;
    const hUnit = document.getElementById("hUnit").value;
    if (hUnit === "cm") h *= 10; // convert cm → mm

    // Get formula
    const formula = document.getElementById("formula").value;

    // Get physical parameters
    let width = parseFloat(document.getElementById("w").value) || 0;
    let length = parseFloat(document.getElementById("l").value) || 0;
    const wUnit = document.getElementById("wUnit").value;
    const lUnit = document.getElementById("lUnit").value;
    if (wUnit === "cm") width *= 10;
    if (lUnit === "cm") length *= 10;

    // Prepare payload
    const payload = {
      er: er,
      h: h,
      formula: formula,
      freq: freq,
      width_mm: width,
      length_mm: length,
    };

    console.log("Payload sent to /analyze:", payload); // debug

    try {
      const response = await fetch("/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (!response.ok) throw new Error("Network response was not ok");
      const data = await response.json();

      if (data.zo !== undefined) {
        document.getElementById("zo").value = data.zo.toFixed(2);
      }
      if (data.elecLen !== undefined) {
        document.getElementById("elecLen").value = data.elecLen.toFixed(2);
      }
    } catch (error) {
      console.error("Analyze request failed:", error);
    }
  });
</script>

  </body>
</html>
